# アーキテクチャ概要 — v0.2

## システム構成
- バックエンド: FastAPI + SQLite。ETL を Celery ワーカー（またはバックグラウンドタスク）で実行。
- フロントエンド: React + TypeScript + Vite。コンポーネント内でのスタイル定義とユーティリティクラスでスタイリング。
- インフラ: 単一コンテナ構成を維持し、ETL 用スクリプトは同一リポジトリ管理。

## データフロー
1. ユーザーが地域・週を指定し `/api/recommend` を呼ぶ。
2. バックエンドは crops、growth_days、price_weekly からデータを結合して応答。
3. `/api/refresh` 呼び出しで ETL が起動し、完了後 etl_runs に履歴を保存。
4. フロントエンドは `/api/refresh/status` を 5 秒ごとにポーリングし、完了通知を表示。
5. 作物選択時に `/api/price` を呼び、チャートへ反映。

## 変更点 v0.2
- 花きデータが既存テーブルに追加されるが構造は変更なし。
- ポーリングとトースト通知の導入により、フロントエンドは状態管理フックを拡張。
- 将来の検索 API 拡張に備え、バックエンドのリポジトリ層でフィルタ構造体の受け口を追加検討。

## 拡張性
- DB 抽象化: SQLModel/SQLAlchemy 層を維持し、PostgreSQL 移行を可能にする。
- API バージョニング: v0 系を継続し、重大変更時に v1 を計画。
- UI: 検索ボックスは将来フィルタグループを追加できるようコンポーネント分割。

## セキュリティ
- 認証なし。将来のトークン導入へ向け CORS・ヘッダ検証を維持。
- ETL の外部通信は HTTPS のみ許可。
