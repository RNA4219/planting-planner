# ETL 仕様 - planting-planner v0.1

## 処理概要
ETL (Extract, Transform, Load) により、公的市場データを週単位に整形し SQLite に格納する。

## Extract
- e-Stat API または CSV/Excel ダウンロード
- 花きデータは農水省の公開ファイルから抽出
- スケジュール: 手動「更新」ボタン → バックエンドで非同期実行

## Transform
- 単位変換（例: 円/10本 → 円/kg）
- 週番号（ISO 週）に丸め込み
- 欠損値処理
  - 過去3週の平均値で補完
  - それも不可なら NULL のまま保持

## Load
- SQLite に UPSERT
- テーブル構造:
  - `crops`（作物マスタ）
  - `prices`（市場価格）
  - `growth_days`（平均生育日数）

## エラーハンドリング
- ダウンロード失敗 → リトライ3回まで
- CSV フォーマット不一致 → スキップしてログ出力
- 失敗時も DB は前回データを維持

## ログ
- `etl_runs` テーブルに記録
  - 実行時刻
  - 成功/失敗
  - 更新件数
  - エラーメッセージ（失敗時）
